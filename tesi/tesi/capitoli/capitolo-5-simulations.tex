% !TEX encoding = UTF-8
% !TEX TS-program = pdflatex
% !TEX root = ../tesi.tex


\chapter{Simulations}
	After the protocols under consideration have been presented in Chapters \ref{chapter:fb} and \ref{chapter:roff}, this Chapter will contain the results of the simulation carried out through various scenario of increasing complexity.
	
	\section{Metrics}
		Before proceeding with the presentation of simulation results, metrics used to evaluate the protocol's performances will be presented in this section. 
		
		\subsection{Total Delivery Ratio (TDR)}
			\label{ssec:tdr}
			This metric is used to detect how many vehicles have received the Alert Message in total. Ideally, broadcasting protocols should be able to reach all the reachable nodes in the scenario in order to warn them of the danger. The metric is calculated as follows:
			
			\begin{gather}
				\label{eq:tdr}
				TDR = \frac{\textrm{\textit{no. of vehicles successfully receiving the Alert Message}}}{\textrm{\textit{no. of vehicles in the scenario}}}
			\end{gather}
			
			All scenarios are created in a way such that every node can be reached by multi-hop propagation regardless of the source of the Alert Message. In other words, from graph theory point of view, the graph resulting from vehicle distribution where two nodes are connected only if they are within transmission range of each other is a connected graph. This way, the term at the denominator of Equation \ref{eq:tdr} is equivalent to the number of vehicles reachable by pure flooding.
			
		\subsection{Total Delivery Ratio On Circumference (TDROC)}
			This metric is used to detect how many vehicles on the circumference have received the Alert Message. The circumference is built starting from the source of the Alert Message. The way it is built depends on scenario topology (e.g. 1D, 2D, etc) and will be explained more thoroughly in the following Sections. The main idea behind the circumference consists in considering only vehicles far from the source of the AM. The metric is calculated as follows:
			
			\begin{gather}
			 	\label{eq:tdroc}
			 	TDROC = \frac{\textrm{\textit{no. of vehicles on circ. successfully receiving the Alert Message}}}{\textrm{\textit{no. of vehicles on circ.}}}
			\end{gather}
		
			The same consideration about vehicles and reachability by pure flooding presented in Section \ref{ssec:tdr} is also valid for Equation \ref{eq:tdroc}.
			
		\subsection{Number Of Hops (NOH)}
			This metric is used to measure the mean number of hops required in order to propagate the Alert Message from the source to all vehicles reached on the circumference. This value is obviously dependent on the paths taken by forwarder Alert Messages from the source to all destinations. We have that \textit{ONOH} is always greater than or equal to the \textit{Optimal Number of Hops BNOH} (i.e. $ONOH \leq NOH$). \textit{BNOH} is calculated using the following formula:
			$$ BNOH = \frac{\textrm{\textit{Circumference Radius}}}{\textrm{\textit{Transmission Range}}} $$
			
			The Number Of Hops metric can be calculated as:
			
			\begin{gather}
				\label{eq:noh}
				NOH = \frac{ \sum_{p \in RC } \textrm{\textit{no. of hops from source to p}}} {\textrm{\textit{no. of vehicles on circ}}}
			\end{gather}
			
			where $RC$ is the set of vehicles which have successfully received the message on the circumference.
			
			
			The \textit{NOH} metric (whose value should be as close as possible to \textit{BNOH} ) is an important indicator of the effectiveness of the multi-hop protocol in choosing the farthest forwarder during contention.
			
			
			Figure \ref{fig:hops} can be used as an example to calculate \textit{NOH}. Using Equation \ref{eq:noh}, the mean number of hops is equal to 3.
			
			\begin{figure}[H]
				\centering
				\includegraphics[width=0.7\textwidth]{immagini/hops}
				\caption{Example of \textit{NOH} calculation with Alert Message starting from node S}
				\label{fig:hops}
			\end{figure}
			
		\subsection{Number Of Slots (NOS)}
			This metric is used to measure the number of slots required in order to propagate the Alert Message from the source to all vehicles reached on the circumference. High values of this metric means that the multi-hop protocol introduces a lot of waiting time before each forwarding, hence increasing end-to-end delay and hurting the timeliness of the emergency message propagation.
		
			\begin{gather}
				\label{eq:slots}
				NOH = \frac{ \sum_{p \in RC } \textrm{\textit{no. of slots waited along path from source to p}}} {\textrm{\textit{no. of vehicles on circ}}}
			\end{gather}	
	
			where $RC$ is the set of vehicles which have successfully received the message on the circumference
			The number of slots along the path from node $a$ to $b$ at the numerator of Equation \ref{eq:slots} is the sum of the slots waited by each forwarder before relaying the Alert Message. 
			
			
			Based on the scenario represented in Figure \ref{fig:slots} and Equation \ref{eq:slots}, the mean number of slots from source S to nodes on the circumference is 100.
			
			\begin{figure}[H]
				\centering
				\includegraphics[width=0.7\textwidth]{immagini/slots}
				\caption{Example of \textit{NOS} calculation with Alert Message starting from node S}
				\label{fig:slots}
			\end{figure}
			
			
		\subsection{Forward Node Ratio (FNR)}
			This metric is used to measure the number of vehicles which forward the Alert Message. The value of this metric is an indicator of the effectiveness of the multi-hop protocol in successfully suppressing scheduled transmissions from PFCs after the FFC has relayed the message. The metric is calculated as follows:
			 
			\begin{gather}
				\label{eq:nos}
				NOH = \textrm{\textit{no. of vehicles forwarding the Alert Message}}
			\end{gather}	
				
	\section{Platoon scenario}
		The first scenario taken into consideration is a simple platoon scenario, where vehicles are placed in a strip-like area 15 kilometers long. Vehicles are 25 meters distant from each other.  Transmission ranges of 100, 300 and 500 has been employed during simulations. 
		Parameters for this scenario are included in Table \ref{table:platoon}.  
		
		\begin{table}[H]
			\def\arraystretch{1.1}
			\rowcolors{2}{D}{P}	
			\begin{tabularx}{\textwidth}{l | l  l}
				\rowcolor{I} {\large \textcolor{white}{Parameter}} & {\large \textcolor{white}{Value}} & {\large \textcolor{white}{}} \TBstrut  \\
				\toprule
				\endhead
	%			\midrule[1pt]
				\rowcolor{P} \multicolumn{3}{c}{Scenario configuration} \\
				\midrule[1pt]
				Road length 							& 15000 				& m		\\
				Distance between vehicles 				& 25					& m		\\
				Circumference							& 14000					& m		\\
				Number of vehicles						& 600					& 		\\
				Source of alert message position		& Left of platoon		&		\\
				\midrule[1pt]
				\rowcolor{P} \multicolumn{3}{c}{Network configuration} \\
				\midrule[1pt]
				Packet size								& 164					& byte	\\	
				Transmission standard					& 802.11b				&		\\
				Frequency								& 2.4					& GHz	\\
				Channel bandwidth						& 22					& MHz	\\
				Transmission speed						& 11					& Mbps	\\
				Transmission powers						& -7.0, 4.6, 13.4		& dBm	\\
				Transmission range						& 100, 300, 500			& m		\\
				Modulation								& DSSS					& 		\\
				Propagation loss model					& ns3::TwoRayGround 	&		\\
				Shadowing model							& None					&		\\
				Propagation delay model					& ns3::ConstantSpeed	&		\\
				\midrule[1pt]
				\rowcolor{P} \multicolumn{3}{c}{Protocols configuration} \\
				\midrule[1pt]
	%			Protocols tested						& \makecell{FB, ROFF, STATIC100, \\ STATIC300, STATIC500} & \\
				FB contention window					& [32, 1024]			& slot	\\
				ROFF distance range (\textit{k} parameter) & 1					&		\\	
				\midrule[1pt]
				Number of simulations per configuration	& 1000					&		\\
				\bottomrule
			\end{tabularx}
			\label{table:platoon}
			\caption{Platoon scenario configuration}
		\end{table}
	
		\begin{figure}[H]
			\centering
			\includegraphics[width=1.1\textwidth]{../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage}
%			\caption{Definition of $minDiff$ between $f_N$ and $f_{N-1}$ (\cite{6906275})}
%			\label{fig:minDiff}
%		\end{figure}
%	
%		\begin{figure}[H]
%			\centering
			\includegraphics[width=1.1\textwidth]{../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage}
			\caption{Definition of $minDiff$ between $f_N$ and $f_{N-1}$ (\cite{6906275})}
			\label{fig:minDiff}
%		\end{figure}
			
%				\begin{figure}[H]
%			\centering
			\includegraphics[width=1.1\textwidth]{../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage}
			%			\caption{Definition of $minDiff$ between $f_N$ and $f_{N-1}$ (\cite{6906275})}
			%			\label{fig:minDiff}
			%		\end{figure}
			%	
			%		\begin{figure}[H]
			%			\centering
			\includegraphics[width=1.1\textwidth]{../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage}
			\caption{Definition of $minDiff$ between $f_N$ and $f_{N-1}$ (\cite{6906275})}
			\label{fig:minDiff}
		\end{figure}




		\begin{figure}[H]
	\centering
	\includegraphics[width=1.1\textwidth]{../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage}
	%			\caption{Definition of $minDiff$ between $f_N$ and $f_{N-1}$ (\cite{6906275})}
	%			\label{fig:minDiff}
	%		\end{figure}
	%	
	%		\begin{figure}[H]
	%			\centering
	\includegraphics[width=1.1\textwidth]{../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage}
	\caption{Definition of $minDiff$ between $f_N$ and $f_{N-1}$ (\cite{6906275})}
	\label{fig:minDiff}
	%		\end{figure}
	%	
	%				\begin{figure}[H]
	%			\centering
	\includegraphics[width=1.1\textwidth]{../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage}
	%			\caption{Definition of $minDiff$ between $f_N$ and $f_{N-1}$ (\cite{6906275})}
	%			\label{fig:minDiff}
	%		\end{figure}
	%	
	%		\begin{figure}[H]
	%			\centering
	\includegraphics[width=1.1\textwidth]{../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage}
	\caption{Definition of $minDiff$ between $f_N$ and $f_{N-1}$ (\cite{6906275})}
	\label{fig:minDiff}
\end{figure}

%		\newcommand{\patha}{folderA}

%		../../scripts/graphs/out/Platoon-15km/b0/j0-cw[32-1024]/totCoverage
	